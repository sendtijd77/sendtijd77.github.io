<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Antibot & Cloaking System</title>
    <script>
        // Configuratie voor antibot gevoeligheid
        const antibotConfig = {
            logDetails: true, // Log verdachte gebruikers
            redirectBots: true, // Redirect bots naar whitepage
            showNeutralPage: false, // Toon neutrale inhoud aan verdachte gebruikers
            whitePage: "https://badbotstraffic-to.here/",
            trustedDelay: 1000, // Tijd in ms voor vertraging bij legitiem verkeer
            botKeywords: [
                "bot", "crawl", "spider", "mediapartners", "slurp", "wget", "curl",
                "python", "java", "fetch", "libwww", "urllib", "node-fetch", "headless"
            ]
        };

        // Functie: Haal een queryparameter op uit de URL
        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        // Utility function: Encrypt IDs (e.g., Base64)
        function encryptID(id) {
            return btoa(id);
        }

        // Utility function: Decrypt IDs
        function decryptID(encryptedId) {
            try {
                return atob(encryptedId);
            } catch (e) {
                console.error('Invalid ID encryption:', e);
                return null;
            }
        }

        // Utility function: Generate a time-sensitive token
        function generateToken(id) {
            const secret = 'your_secret_key'; // Replace with a secure key
            const timestamp = Math.floor(Date.now() / 1000); // Current time in seconds
            return btoa(`${id}:${timestamp}:${secret}`);
        }

        // Validate token server-side (to be implemented server-side)
        function isValidToken(token) {
            // Stub for server-side token validation
            return true; // Replace with actual server-side validation logic
        }

        // Utility function: Validate SHA256 hash
        function validateHash(id, hash) {
            const secret = 'your_secret_key';
            const generatedHash = CryptoJS.SHA256(`${id}:${secret}`).toString();
            return generatedHash === hash;
        }

        // Redirect based on encrypted ID with validation
        function redirectBasedOnId() {
            const encryptedId = getQueryParam("id");
            const hash = getQueryParam("hash");
            const id = decryptID(encryptedId);

            if (!id || !validateHash(id, hash)) {
                document.body.textContent = 'Invalid Request';
                return;
            }

            const redirectMap = {
                "123": "https://youtube.com",
                "456": "https://google.com",
                "789": "https://facebook.com"
            };

            const url = redirectMap[id];
            if (!url) {
                document.body.textContent = 'Invalid Request';
                return;
            }

            window.location.href = url;
        }

        // Functie: Antibotdetectie
        function detectBot() {
            const { botKeywords } = antibotConfig;
            const userAgent = navigator.userAgent || "";

            // Controleer op verdachte User-Agent keywords
            for (const keyword of botKeywords) {
                if (userAgent.toLowerCase().includes(keyword)) {
                    console.log("Suspicious User-Agent detected:", userAgent);
                    return true;
                }
            }

            // Headless browser detectie via navigator.webdriver
            if (navigator.webdriver) {
                console.log("Headless browser detected.");
                return true;
            }

            // Verdachte snelheden (toekomstige implementatie)
            // Plaats logica hier voor snelheid van interactie

            return false; // Verkeer wordt als legitiem beschouwd
        }

        // Functie: Toon neutrale inhoud
        function showNeutralContent() {
            document.body.innerHTML = `
                <h1>Welcome</h1>
                <p>This is a neutral page shown to suspected bots.</p>
            `;
        }

        // Functie: Logging voor verdachte gebruikers
        function logSuspectedTraffic() {
            if (antibotConfig.logDetails) {
                const userAgent = navigator.userAgent;
                const language = navigator.language || "unknown";
                console.log("Suspicious Traffic Logged:");
                console.log(`User-Agent: ${userAgent}`);
                console.log(`Language: ${language}`);
            }
        }

        // Functie: Verbeterde link cloaking
        function improvedLinkCloaking() {
            // a. Dynamische URL-aanpassing voor cloaking
            const links = document.querySelectorAll('a');
            links.forEach(link => {
                link.href = `/cloaked?target=${encodeURIComponent(link.href)}`;
            });

            // b. Beveiliging tegen inspectietools
            document.addEventListener('contextmenu', event => event.preventDefault());
            document.addEventListener('keydown', event => {
                if (event.key === 'F12' || (event.ctrlKey && event.shiftKey && event.key === 'I')) {
                    event.preventDefault();
                }
            });

            // c. Extra cloaking logica
            console.log("Link cloaking initialized.");
        }

        // Anti-Bot Detection Logic
        function detectBots() {
            const isBot = navigator.webdriver || /bot|crawl|spider|robot|crawling/i.test(navigator.userAgent);

            if (isBot) {
                document.body.textContent = 'Access Denied';
                return true;
            }

            let interactionDetected = false;
            window.addEventListener('mousemove', () => interactionDetected = true);
            window.addEventListener('click', () => interactionDetected = true);
            window.addEventListener('scroll', () => interactionDetected = true);

            setTimeout(() => {
                if (!interactionDetected) {
                    document.body.textContent = 'Access Denied';
                }
            }, 5000);

            return false;
        }

        // Monitoring and Logging
        function logSuspiciousActivity(activity) {
            fetch('/log', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(activity),
            });
        }

        function setupLogging() {
            window.addEventListener('error', (e) => {
                logSuspiciousActivity({ type: 'error', message: e.message, stack: e.error?.stack });
            });

            window.addEventListener('unhandledrejection', (e) => {
                logSuspiciousActivity({ type: 'promise-rejection', message: e.reason });
            });
        }

        // Strict Content Security Policy
        function applyCSP() {
            const meta = document.createElement('meta');
            meta.httpEquiv = 'Content-Security-Policy';
            meta.content = "default-src 'self';";
            document.head.appendChild(meta);
        }

        // Main Entry Point
        function init() {
            if (detectBots()) return;
            logSuspectedTraffic();
            redirectBasedOnId();
            improvedLinkCloaking();
            applyCSP();
            setupLogging();
        }

        // Initialize the script
        init();
    </script>
</head>
<body>
    <h1>Antibot & Cloaking System Active</h1>
</body>
</html>
